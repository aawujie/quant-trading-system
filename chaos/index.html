<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightweight Charts Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .chart-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .chart-section:hover {
            transform: translateY(-5px);
        }

        .chart-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chart-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            position: relative;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .info-box code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #d63384;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Lightweight Charts ä½¿ç”¨æ¼”ç¤º</h1>

        <!-- Kçº¿å›¾ -->
        <div class="chart-section">
            <div class="chart-title">
                <span>1. èœ¡çƒ›å›¾ï¼ˆKçº¿å›¾ï¼‰</span>
            </div>
            <div class="chart-description">
                å±•ç¤ºä¼ ç»Ÿçš„ OHLCï¼ˆå¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·ï¼‰èœ¡çƒ›å›¾ï¼Œå¸¸ç”¨äºè‚¡ç¥¨å’ŒåŠ å¯†è´§å¸äº¤æ˜“åˆ†æã€‚
            </div>
            <div id="candlestick-chart" class="chart-container"></div>
            <div class="controls">
                <button onclick="addCandlestickData()">æ·»åŠ æ–°æ•°æ®</button>
                <button onclick="toggleCandlestickTheme()">åˆ‡æ¢ä¸»é¢˜</button>
                <button onclick="resetCandlestickZoom()">é‡ç½®ç¼©æ”¾</button>
            </div>
            <div class="info-box">
                ğŸ’¡ <strong>æç¤ºï¼š</strong>ä½ å¯ä»¥ä½¿ç”¨é¼ æ ‡æ»šè½®ç¼©æ”¾å›¾è¡¨ï¼Œæ‹–åŠ¨ä»¥å¹³ç§»æŸ¥çœ‹ä¸åŒæ—¶é—´æ®µçš„æ•°æ®ã€‚
            </div>
        </div>

        <!-- çº¿å½¢å›¾ -->
        <div class="chart-section">
            <div class="chart-title">
                <span>2. çº¿å½¢å›¾</span>
            </div>
            <div class="chart-description">
                ç®€æ´çš„çº¿å½¢å›¾ï¼Œé€‚åˆå±•ç¤ºä»·æ ¼è¶‹åŠ¿æˆ–è¿ç»­æ•°æ®å˜åŒ–ã€‚
            </div>
            <div id="line-chart" class="chart-container"></div>
            <div class="controls">
                <button onclick="updateLineData()">æ›´æ–°æ•°æ®</button>
                <button onclick="changeLineColor()">æ”¹å˜é¢œè‰²</button>
            </div>
        </div>

        <!-- é¢ç§¯å›¾ -->
        <div class="chart-section">
            <div class="chart-title">
                <span>3. é¢ç§¯å›¾</span>
            </div>
            <div class="chart-description">
                å¸¦æœ‰å¡«å……åŒºåŸŸçš„é¢ç§¯å›¾ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°å±•ç¤ºæ•°æ®çš„ç´¯ç§¯æ•ˆæœã€‚
            </div>
            <div id="area-chart" class="chart-container"></div>
            <div class="controls">
                <button onclick="addAreaData()">æ·»åŠ æ•°æ®ç‚¹</button>
                <button onclick="toggleAreaGradient()">åˆ‡æ¢æ¸å˜</button>
            </div>
        </div>

        <!-- æŸ±çŠ¶å›¾ -->
        <div class="chart-section">
            <div class="chart-title">
                <span>4. æŸ±çŠ¶å›¾ï¼ˆæˆäº¤é‡ï¼‰</span>
            </div>
            <div class="chart-description">
                æŸ±çŠ¶å›¾å¸¸ç”¨äºå±•ç¤ºæˆäº¤é‡æˆ–å…¶ä»–ç¦»æ•£æ•°æ®ã€‚
            </div>
            <div id="histogram-chart" class="chart-container"></div>
            <div class="controls">
                <button onclick="updateHistogramData()">éšæœºæ•°æ®</button>
            </div>
        </div>

        <!-- å¤šç³»åˆ—å›¾è¡¨ -->
        <div class="chart-section">
            <div class="chart-title">
                <span>5. å¤šç³»åˆ—ç»„åˆå›¾è¡¨</span>
            </div>
            <div class="chart-description">
                åœ¨åŒä¸€ä¸ªå›¾è¡¨ä¸­å±•ç¤ºå¤šä¸ªæ•°æ®ç³»åˆ—ï¼Œæ¯”å¦‚ä»·æ ¼ + ç§»åŠ¨å¹³å‡çº¿ + æˆäº¤é‡ã€‚
            </div>
            <div id="multi-series-chart" class="chart-container"></div>
            <div class="controls">
                <button onclick="toggleMA()">åˆ‡æ¢å‡çº¿æ˜¾ç¤º</button>
                <button onclick="toggleVolume()">åˆ‡æ¢æˆäº¤é‡</button>
            </div>
            <div class="info-box">
                ğŸ“ˆ <strong>ç»„åˆå±•ç¤ºï¼š</strong>è“è‰²Kçº¿ + çº¢è‰²20æ—¥å‡çº¿ + ç»¿è‰²50æ—¥å‡çº¿ + åº•éƒ¨æˆäº¤é‡æŸ±çŠ¶å›¾
            </div>
        </div>
    </div>

    <script src="node_modules/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        // ç­‰å¾… DOM åŠ è½½å®Œæˆ
        window.addEventListener('DOMContentLoaded', function() {
            initCharts();
        });

        function initCharts() {
        // ========== 1. èœ¡çƒ›å›¾ ==========
        let candlestickChart = LightweightCharts.createChart(document.getElementById('candlestick-chart'), {
            width: document.getElementById('candlestick-chart').clientWidth,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
            grid: {
                vertLines: { color: '#e1e1e1' },
                horzLines: { color: '#e1e1e1' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
            rightPriceScale: {
                borderColor: '#cccccc',
            },
            timeScale: {
                borderColor: '#cccccc',
                timeVisible: true,
                secondsVisible: false,
            },
        });

        let candlestickSeries = candlestickChart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderVisible: false,
            wickUpColor: '#26a69a',
            wickDownColor: '#ef5350',
        });

        // ç”Ÿæˆæ¨¡æ‹ŸKçº¿æ•°æ®
        function generateCandlestickData(count = 100) {
            const data = [];
            let basePrice = 100;
            const startTime = Math.floor(Date.now() / 1000) - count * 86400;

            for (let i = 0; i < count; i++) {
                const time = startTime + i * 86400;
                const randomWalk = (Math.random() - 0.5) * 3;
                basePrice += randomWalk;
                
                const open = basePrice + (Math.random() - 0.5) * 2;
                const close = basePrice + (Math.random() - 0.5) * 2;
                const high = Math.max(open, close) + Math.random() * 2;
                const low = Math.min(open, close) - Math.random() * 2;

                data.push({
                    time: time,
                    open: open,
                    high: high,
                    low: low,
                    close: close,
                });
            }
            return data;
        }

        const candlestickData = generateCandlestickData(100);
        candlestickSeries.setData(candlestickData);

        let isDarkTheme = false;
        function toggleCandlestickTheme() {
            isDarkTheme = !isDarkTheme;
            candlestickChart.applyOptions({
                layout: {
                    background: { color: isDarkTheme ? '#1e1e1e' : '#ffffff' },
                    textColor: isDarkTheme ? '#d1d4dc' : '#333',
                },
                grid: {
                    vertLines: { color: isDarkTheme ? '#2a2a2a' : '#e1e1e1' },
                    horzLines: { color: isDarkTheme ? '#2a2a2a' : '#e1e1e1' },
                },
            });
        }

        function addCandlestickData() {
            const lastCandle = candlestickData[candlestickData.length - 1];
            const newTime = lastCandle.time + 86400;
            const basePrice = lastCandle.close;
            
            const open = basePrice + (Math.random() - 0.5) * 2;
            const close = basePrice + (Math.random() - 0.5) * 3;
            const high = Math.max(open, close) + Math.random() * 2;
            const low = Math.min(open, close) - Math.random() * 2;

            const newCandle = {
                time: newTime,
                open: open,
                high: high,
                low: low,
                close: close,
            };

            candlestickData.push(newCandle);
            candlestickSeries.update(newCandle);
        }

        function resetCandlestickZoom() {
            candlestickChart.timeScale().fitContent();
        }

        // ========== 2. çº¿å½¢å›¾ ==========
        let lineChart = LightweightCharts.createChart(document.getElementById('line-chart'), {
            width: document.getElementById('line-chart').clientWidth,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
            grid: {
                vertLines: { color: '#e1e1e1' },
                horzLines: { color: '#e1e1e1' },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
            },
        });

        let lineSeries = lineChart.addSeries(LightweightCharts.LineSeries, {
            color: '#2962FF',
            lineWidth: 2,
        });

        function generateLineData(count = 100) {
            const data = [];
            let value = 100;
            const startTime = Math.floor(Date.now() / 1000) - count * 86400;

            for (let i = 0; i < count; i++) {
                value += (Math.random() - 0.5) * 5;
                data.push({
                    time: startTime + i * 86400,
                    value: value,
                });
            }
            return data;
        }

        lineSeries.setData(generateLineData(100));

        const colors = ['#2962FF', '#FF6B6B', '#4ECDC4', '#FFA07A', '#98D8C8'];
        let colorIndex = 0;

        function changeLineColor() {
            colorIndex = (colorIndex + 1) % colors.length;
            lineSeries.applyOptions({
                color: colors[colorIndex],
            });
        }

        function updateLineData() {
            lineSeries.setData(generateLineData(100));
        }

        // ========== 3. é¢ç§¯å›¾ ==========
        let areaChart = LightweightCharts.createChart(document.getElementById('area-chart'), {
            width: document.getElementById('area-chart').clientWidth,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
        });

        let areaSeries = areaChart.addSeries(LightweightCharts.AreaSeries, {
            topColor: 'rgba(38, 166, 154, 0.4)',
            bottomColor: 'rgba(38, 166, 154, 0.0)',
            lineColor: 'rgba(38, 166, 154, 1)',
            lineWidth: 2,
        });

        const areaData = generateLineData(80);
        areaSeries.setData(areaData);

        let useGradient = true;
        function toggleAreaGradient() {
            useGradient = !useGradient;
            if (useGradient) {
                areaSeries.applyOptions({
                    topColor: 'rgba(38, 166, 154, 0.4)',
                    bottomColor: 'rgba(38, 166, 154, 0.0)',
                });
            } else {
                areaSeries.applyOptions({
                    topColor: 'rgba(38, 166, 154, 0.2)',
                    bottomColor: 'rgba(38, 166, 154, 0.2)',
                });
            }
        }

        function addAreaData() {
            const lastPoint = areaData[areaData.length - 1];
            const newPoint = {
                time: lastPoint.time + 86400,
                value: lastPoint.value + (Math.random() - 0.5) * 5,
            };
            areaData.push(newPoint);
            areaSeries.update(newPoint);
        }

        // ========== 4. æŸ±çŠ¶å›¾ ==========
        let histogramChart = LightweightCharts.createChart(document.getElementById('histogram-chart'), {
            width: document.getElementById('histogram-chart').clientWidth,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
        });

        let histogramSeries = histogramChart.addSeries(LightweightCharts.HistogramSeries, {
            color: '#26a69a',
            priceFormat: {
                type: 'volume',
            },
            priceScaleId: '',
        });

        function generateHistogramData(count = 100) {
            const data = [];
            const startTime = Math.floor(Date.now() / 1000) - count * 86400;

            for (let i = 0; i < count; i++) {
                const value = Math.random() * 100 + 20;
                const color = Math.random() > 0.5 ? '#26a69a' : '#ef5350';
                
                data.push({
                    time: startTime + i * 86400,
                    value: value,
                    color: color,
                });
            }
            return data;
        }

        histogramSeries.setData(generateHistogramData(100));

        function updateHistogramData() {
            histogramSeries.setData(generateHistogramData(100));
        }

        // ========== 5. å¤šç³»åˆ—ç»„åˆå›¾è¡¨ ==========
        let multiChart = LightweightCharts.createChart(document.getElementById('multi-series-chart'), {
            width: document.getElementById('multi-series-chart').clientWidth,
            height: 400,
            layout: {
                background: { color: '#ffffff' },
                textColor: '#333',
            },
            grid: {
                vertLines: { color: '#e1e1e1' },
                horzLines: { color: '#e1e1e1' },
            },
        });

        // ä¸»Kçº¿
        let mainCandlestickSeries = multiChart.addSeries(LightweightCharts.CandlestickSeries, {
            upColor: '#26a69a',
            downColor: '#ef5350',
            borderVisible: false,
            wickUpColor: '#26a69a',
            wickDownColor: '#ef5350',
        });
        mainCandlestickSeries.setData(candlestickData);

        // 20æ—¥ç§»åŠ¨å¹³å‡çº¿
        let ma20Series = multiChart.addSeries(LightweightCharts.LineSeries, {
            color: '#FF6B6B',
            lineWidth: 2,
            title: 'MA20',
        });

        // 50æ—¥ç§»åŠ¨å¹³å‡çº¿
        let ma50Series = multiChart.addSeries(LightweightCharts.LineSeries, {
            color: '#4ECDC4',
            lineWidth: 2,
            title: 'MA50',
        });

        // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        function calculateMA(data, period) {
            const ma = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) continue;
                
                let sum = 0;
                for (let j = 0; j < period; j++) {
                    sum += data[i - j].close;
                }
                ma.push({
                    time: data[i].time,
                    value: sum / period,
                });
            }
            return ma;
        }

        const ma20Data = calculateMA(candlestickData, 20);
        const ma50Data = calculateMA(candlestickData, 50);
        ma20Series.setData(ma20Data);
        ma50Series.setData(ma50Data);

        // æˆäº¤é‡ï¼ˆåœ¨åº•éƒ¨ï¼‰
        let volumeSeries = multiChart.addSeries(LightweightCharts.HistogramSeries, {
            color: '#26a69a',
            priceFormat: {
                type: 'volume',
            },
            priceScaleId: 'volume',
        });

        multiChart.priceScale('volume').applyOptions({
            scaleMargins: {
                top: 0.8,
                bottom: 0,
            },
        });

        const volumeData = candlestickData.map(candle => ({
            time: candle.time,
            value: Math.random() * 1000000 + 100000,
            color: candle.close >= candle.open ? '#26a69a80' : '#ef535080',
        }));
        volumeSeries.setData(volumeData);

        let ma20Visible = true;
        let ma50Visible = true;
        let volumeVisible = true;

        function toggleMA() {
            ma20Visible = !ma20Visible;
            ma50Visible = !ma50Visible;
            ma20Series.applyOptions({ visible: ma20Visible });
            ma50Series.applyOptions({ visible: ma50Visible });
        }

        function toggleVolume() {
            volumeVisible = !volumeVisible;
            volumeSeries.applyOptions({ visible: volumeVisible });
        }

        // å“åº”å¼è°ƒæ•´
        window.addEventListener('resize', () => {
            const charts = [
                { chart: candlestickChart, id: 'candlestick-chart' },
                { chart: lineChart, id: 'line-chart' },
                { chart: areaChart, id: 'area-chart' },
                { chart: histogramChart, id: 'histogram-chart' },
                { chart: multiChart, id: 'multi-series-chart' },
            ];

            charts.forEach(({ chart, id }) => {
                const container = document.getElementById(id);
                chart.applyOptions({ width: container.clientWidth });
            });
        });
        } // ç»“æŸ initCharts å‡½æ•°
    </script>
</body>
</html>

