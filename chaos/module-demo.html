<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—åŒ–ä½¿ç”¨ç¤ºä¾‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #333;
        }

        .card-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .chart-wrapper {
            width: 100%;
            height: 400px;
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        button.secondary {
            background: #6c757d;
        }

        .code-block {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #333;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2962FF;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .info-box strong {
            color: #2962FF;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æ¨¡å—åŒ–ä½¿ç”¨ç¤ºä¾‹</h1>

        <!-- ç¤ºä¾‹ 1ï¼šåŸºæœ¬ç”¨æ³• -->
        <div class="card">
            <div class="card-title">ç¤ºä¾‹ 1ï¼šä½¿ç”¨ ChartManager ç±»</div>
            <div class="card-description">
                ä½¿ç”¨å°è£…å¥½çš„ ChartManager ç±»ï¼Œå¿«é€Ÿåˆ›å»ºå’Œç®¡ç†å›¾è¡¨ã€‚
            </div>
            <div id="chart1" class="chart-wrapper"></div>
            <div class="controls">
                <button onclick="example1.addData()">æ·»åŠ æ•°æ®</button>
                <button onclick="example1.toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
                <button onclick="example1.fitContent()">é€‚é…å†…å®¹</button>
            </div>
            <div class="code-block">
                <pre>
// åˆ›å»ºå›¾è¡¨ç®¡ç†å™¨
const manager = new ChartManager('chart1');

// æ·»åŠ èœ¡çƒ›å›¾ç³»åˆ—
manager.addCandlestickSeries('main');

// æ·»åŠ ç§»åŠ¨å¹³å‡çº¿
manager.addLineSeries('ma20', { color: '#FF6B6B' });

// æ›´æ–°æ•°æ®
manager.updateSeriesData('main', candlestickData);
manager.updateSeriesData('ma20', ma20Data);
                </pre>
            </div>
        </div>

        <!-- ç¤ºä¾‹ 2ï¼šæŠ€æœ¯æŒ‡æ ‡è®¡ç®— -->
        <div class="card">
            <div class="card-title">ç¤ºä¾‹ 2ï¼šæŠ€æœ¯æŒ‡æ ‡è®¡ç®—</div>
            <div class="card-description">
                ä½¿ç”¨ IndicatorCalculator ç±»è®¡ç®—å„ç§æŠ€æœ¯æŒ‡æ ‡ã€‚
            </div>
            <div id="chart2" class="chart-wrapper"></div>
            <div class="controls">
                <button onclick="example2.toggleSMA()">åˆ‡æ¢ SMA</button>
                <button onclick="example2.toggleEMA()">åˆ‡æ¢ EMA</button>
                <button onclick="example2.updateData()">æ›´æ–°æ•°æ®</button>
            </div>
            <div class="code-block">
                <pre>
// è®¡ç®—ç®€å•ç§»åŠ¨å¹³å‡çº¿
const sma20 = IndicatorCalculator.calculateSMA(data, 20);

// è®¡ç®—æŒ‡æ•°ç§»åŠ¨å¹³å‡çº¿
const ema12 = IndicatorCalculator.calculateEMA(data, 12);

// è®¡ç®— RSI
const rsi = IndicatorCalculator.calculateRSI(data, 14);

// è®¡ç®— MACD
const { macdLine, signalLine, histogram } = 
    IndicatorCalculator.calculateMACD(data);
                </pre>
            </div>
        </div>

        <!-- ç¤ºä¾‹ 3ï¼šå¸ƒæ—å¸¦ -->
        <div class="card">
            <div class="card-title">ç¤ºä¾‹ 3ï¼šå¸ƒæ—å¸¦æŒ‡æ ‡</div>
            <div class="card-description">
                å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¸ƒæ—å¸¦ï¼ˆBollinger Bandsï¼‰æŒ‡æ ‡ã€‚
            </div>
            <div id="chart3" class="chart-wrapper"></div>
            <div class="controls">
                <button onclick="example3.updatePeriod(10)">10å‘¨æœŸ</button>
                <button onclick="example3.updatePeriod(20)">20å‘¨æœŸ</button>
                <button onclick="example3.updatePeriod(30)">30å‘¨æœŸ</button>
                <button class="secondary" onclick="example3.updateStdDev(1)">1Ïƒ</button>
                <button class="secondary" onclick="example3.updateStdDev(2)">2Ïƒ</button>
                <button class="secondary" onclick="example3.updateStdDev(3)">3Ïƒ</button>
            </div>
            <div class="info-box">
                <strong>ğŸ’¡ å¸ƒæ—å¸¦è¯´æ˜ï¼š</strong> å¸ƒæ—å¸¦ç”±ä¸­è½¨ï¼ˆç§»åŠ¨å¹³å‡çº¿ï¼‰å’Œä¸Šä¸‹è½¨ï¼ˆæ ‡å‡†å·®å¸¦ï¼‰ç»„æˆã€‚ä»·æ ¼é€šå¸¸åœ¨å¸ƒæ—å¸¦å†…æ³¢åŠ¨ï¼Œçªç ´ä¸Šä¸‹è½¨å¯èƒ½æ„å‘³ç€è¶‹åŠ¿çš„å¼€å§‹æˆ–åè½¬ã€‚
            </div>
        </div>

        <!-- ç¤ºä¾‹ 4ï¼šæ•°æ®ç”Ÿæˆå™¨ -->
        <div class="card">
            <div class="card-title">ç¤ºä¾‹ 4ï¼šæ•°æ®ç”Ÿæˆå™¨</div>
            <div class="card-description">
                ä½¿ç”¨ DataGenerator ç±»ç”Ÿæˆæµ‹è¯•æ•°æ®ã€‚
            </div>
            <div id="chart4" class="chart-wrapper"></div>
            <div class="controls">
                <button onclick="example4.generateNew()">ç”Ÿæˆæ–°æ•°æ®</button>
                <button onclick="example4.changeVolatility('low')">ä½æ³¢åŠ¨</button>
                <button onclick="example4.changeVolatility('medium')">ä¸­æ³¢åŠ¨</button>
                <button onclick="example4.changeVolatility('high')">é«˜æ³¢åŠ¨</button>
            </div>
            <div class="code-block">
                <pre>
// ç”Ÿæˆèœ¡çƒ›å›¾æ•°æ®
const candleData = DataGenerator.generateCandlestickData(100, 100);

// ç”Ÿæˆçº¿å½¢æ•°æ®
const lineData = DataGenerator.generateLineData(100, 100, 5);

// ç”Ÿæˆæˆäº¤é‡æ•°æ®
const volumeData = DataGenerator.generateVolumeData(candleData);
                </pre>
            </div>
        </div>
    </div>

    <script src="node_modules/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script type="module">
        import { 
            ChartManager, 
            IndicatorCalculator, 
            DataGenerator 
        } from './chart-utils.js';

        // ========== ç¤ºä¾‹ 1ï¼šåŸºæœ¬ç”¨æ³• ==========
        window.example1 = {
            manager: new ChartManager('chart1'),
            isDark: false,
            data: null,

            init() {
                // ç”Ÿæˆæ•°æ®
                this.data = DataGenerator.generateCandlestickData(100, 100);
                
                // æ·»åŠ ç³»åˆ—
                this.manager.addCandlestickSeries('main');
                this.manager.addLineSeries('ma20', { color: '#FF6B6B', lineWidth: 1 });
                this.manager.addLineSeries('ma50', { color: '#4ECDC4', lineWidth: 1 });
                
                // æ›´æ–°æ•°æ®
                this.updateData();
            },

            updateData() {
                const ma20 = IndicatorCalculator.calculateSMA(this.data, 20);
                const ma50 = IndicatorCalculator.calculateSMA(this.data, 50);
                
                this.manager.updateSeriesData('main', this.data);
                this.manager.updateSeriesData('ma20', ma20);
                this.manager.updateSeriesData('ma50', ma50);
            },

            addData() {
                const lastCandle = this.data[this.data.length - 1];
                const newCandle = {
                    time: lastCandle.time + 86400,
                    open: lastCandle.close,
                    high: lastCandle.close + Math.random() * 3,
                    low: lastCandle.close - Math.random() * 3,
                    close: lastCandle.close + (Math.random() - 0.5) * 4
                };
                this.data.push(newCandle);
                this.updateData();
            },

            toggleTheme() {
                this.isDark = !this.isDark;
                this.manager.setTheme(this.isDark);
            },

            fitContent() {
                this.manager.fitContent();
            }
        };

        // ========== ç¤ºä¾‹ 2ï¼šæŠ€æœ¯æŒ‡æ ‡è®¡ç®— ==========
        window.example2 = {
            manager: new ChartManager('chart2'),
            data: null,
            showSMA: true,
            showEMA: true,

            init() {
                this.data = DataGenerator.generateLineData(100, 100, 3);
                
                this.manager.addLineSeries('price', { color: '#2962FF', lineWidth: 2 });
                this.manager.addLineSeries('sma', { color: '#FF6B6B', lineWidth: 1 });
                this.manager.addLineSeries('ema', { color: '#4ECDC4', lineWidth: 1 });
                
                this.updateData();
            },

            updateData() {
                const sma = IndicatorCalculator.calculateSMA(this.data, 20);
                const ema = IndicatorCalculator.calculateEMA(this.data, 20);
                
                this.manager.updateSeriesData('price', this.data);
                this.manager.updateSeriesData('sma', sma);
                this.manager.updateSeriesData('ema', ema);
            },

            toggleSMA() {
                this.showSMA = !this.showSMA;
                const series = this.manager.getSeries('sma');
                series.applyOptions({ visible: this.showSMA });
            },

            toggleEMA() {
                this.showEMA = !this.showEMA;
                const series = this.manager.getSeries('ema');
                series.applyOptions({ visible: this.showEMA });
            },

            updateData() {
                this.data = DataGenerator.generateLineData(100, 100, 3);
                const sma = IndicatorCalculator.calculateSMA(this.data, 20);
                const ema = IndicatorCalculator.calculateEMA(this.data, 20);
                
                this.manager.updateSeriesData('price', this.data);
                this.manager.updateSeriesData('sma', sma);
                this.manager.updateSeriesData('ema', ema);
            }
        };

        // ========== ç¤ºä¾‹ 3ï¼šå¸ƒæ—å¸¦ ==========
        window.example3 = {
            manager: new ChartManager('chart3'),
            data: null,
            period: 20,
            stdDev: 2,

            init() {
                this.data = DataGenerator.generateLineData(100, 100, 3);
                
                this.manager.addLineSeries('price', { 
                    color: '#2962FF', 
                    lineWidth: 2 
                });
                this.manager.addLineSeries('upper', { 
                    color: '#ef5350', 
                    lineWidth: 1,
                    lineStyle: LightweightCharts.LineStyle.Dashed 
                });
                this.manager.addLineSeries('middle', { 
                    color: '#999', 
                    lineWidth: 1 
                });
                this.manager.addLineSeries('lower', { 
                    color: '#26a69a', 
                    lineWidth: 1,
                    lineStyle: LightweightCharts.LineStyle.Dashed 
                });
                
                this.updateBands();
            },

            updateBands() {
                const { upper, middle, lower } = 
                    IndicatorCalculator.calculateBollingerBands(this.data, this.period, this.stdDev);
                
                this.manager.updateSeriesData('price', this.data);
                this.manager.updateSeriesData('upper', upper);
                this.manager.updateSeriesData('middle', middle);
                this.manager.updateSeriesData('lower', lower);
            },

            updatePeriod(period) {
                this.period = period;
                this.updateBands();
            },

            updateStdDev(stdDev) {
                this.stdDev = stdDev;
                this.updateBands();
            }
        };

        // ========== ç¤ºä¾‹ 4ï¼šæ•°æ®ç”Ÿæˆå™¨ ==========
        window.example4 = {
            manager: new ChartManager('chart4'),
            volatility: 3,

            init() {
                this.manager.addCandlestickSeries('main');
                this.manager.addHistogramSeries('volume', {
                    priceScaleId: 'volume'
                });
                
                this.manager.chart.priceScale('volume').applyOptions({
                    scaleMargins: { top: 0.8, bottom: 0 }
                });
                
                this.generateNew();
            },

            generateNew() {
                const candleData = DataGenerator.generateCandlestickData(100, 100);
                const volumeData = DataGenerator.generateVolumeData(candleData);
                
                this.manager.updateSeriesData('main', candleData);
                this.manager.updateSeriesData('volume', volumeData);
            },

            changeVolatility(level) {
                const volatilityMap = {
                    low: 1,
                    medium: 3,
                    high: 6
                };
                this.volatility = volatilityMap[level];
                this.generateNew();
            }
        };

        // åˆå§‹åŒ–æ‰€æœ‰ç¤ºä¾‹
        window.addEventListener('DOMContentLoaded', function() {
            example1.init();
            example2.init();
            example3.init();
            example4.init();
        });
    </script>
</body>
</html>

