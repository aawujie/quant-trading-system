# 📊 数据管理中心使用指南

## 概述

数据管理中心是一个强大的功能模块，让你可以轻松下载和管理历史交易数据。

## ✨ 功能特点

### 1. 历史数据下载
- 📥 下载指定时间范围的历史K线数据
- ⚡ 异步后台下载，不阻塞其他操作
- 📊 实时进度显示
- 🔄 支持取消下载

### 2. 数据统计
- 📈 查看数据库K线总数
- 💰 监控的币种列表
- ⏱️ 支持的时间周期
- 📅 数据时间范围

---

## 🚀 快速开始

### 访问数据管理中心

1. 启动应用后，点击顶部导航栏的 **📊 数据管理** 按钮
2. 你将看到两个选项卡：
   - **📥 历史下载** - 创建和管理下载任务
   - **📈 数据统计** - 查看数据库统计信息

---

## 📥 历史数据下载

### 创建下载任务

1. 在"历史下载"页面，填写表单：
   - **币种**：选择要下载的交易对（BTCUSDT、ETHUSDT等）
   - **时间周期**：选择K线周期（1m、5m、1h、1d等）
   - **市场类型**：现货或永续合约
   - **开始时间**：数据起始时间
   - **结束时间**：数据截止时间

2. 点击 **🚀 开始下载**

3. 任务将自动开始下载

### 查看下载进度

下载任务卡片显示：
- ✅ 任务状态（等待中、下载中、已完成、失败）
- 📊 进度条和百分比
- 📈 已下载/总数量
- 🕐 时间范围

### 管理任务

- **取消下载**：点击任务卡片中的"取消"按钮
- **自动刷新**：任务列表每3秒自动刷新

---

## 📈 数据统计

### 统计信息包括

1. **概览卡片**
   - 📊 K线总数
   - 💰 监控币种数量
   - ⏱️ 时间周期数量
   - 🏪 市场类型数量

2. **详细信息**
   - 📅 最早和最新数据时间
   - 💰 所有币种列表
   - ⏱️ 所有时间周期
   - 🏪 市场类型

3. **自动刷新**
   - 统计数据每10秒自动更新
   - 可手动点击刷新按钮

---

## 💡 使用示例

### 示例1：下载BTC最近7天的1小时数据

```
币种：BTCUSDT
时间周期：1h
市场类型：永续合约
开始时间：2024-12-25 00:00
结束时间：2025-01-01 23:59
```

点击"开始下载"后，系统将：
1. 创建下载任务
2. 自动分批从币安API获取数据
3. 存储到PostgreSQL数据库
4. 实时更新进度

预计下载：约168条K线（7天 × 24小时）

### 示例2：批量下载多个币种

创建多个任务，系统会并行处理：

**任务1：**
- BTCUSDT / 1h / 最近30天

**任务2：**
- ETHUSDT / 1h / 最近30天

**任务3：**
- SOLUSDT / 1h / 最近30天

---

## ⚙️ 技术实现

### 后端架构

```
用户请求 → REST API → DataManager
                         ↓
                  AsyncIO 任务调度
                         ↓
          ┌──────────────┼──────────────┐
          ↓              ↓              ↓
    币安API获取     进度更新       数据库存储
          ↓              ↓              ↓
      分批下载        实时追踪      PostgreSQL
```

### API端点

**创建下载任务：**
```http
POST /api/data/download
{
  "symbol": "BTCUSDT",
  "timeframe": "1h",
  "start_time": 1703462400,
  "end_time": 1704067200,
  "market_type": "future"
}
```

**获取任务状态：**
```http
GET /api/data/download/{task_id}
```

**获取数据统计：**
```http
GET /api/data/stats
```

---

## 🎯 最佳实践

### 1. 下载时间范围

- ✅ **推荐**：一次下载不超过90天
- ⚠️ **注意**：时间跨度过大可能耗时较长
- 💡 **技巧**：分多个任务并行下载

### 2. 时间周期选择

| 周期 | 适用场景 | 数据量 |
|------|----------|--------|
| 1m | 日内交易、高频策略 | 大 |
| 5m | 短线交易 | 中等 |
| 1h | 常规回测 | 适中 |
| 1d | 长期分析 | 小 |

### 3. 避免重复下载

- 下载前查看"数据统计"，确认是否已有数据
- 数据库会自动去重，相同时间戳的数据会被覆盖

### 4. 性能优化

- 系统自动分批下载（每批1000条）
- 请求间隔0.5秒，避免触发API限流
- 数据批量写入，提高效率

---

## 🔧 故障排查

### 下载失败

**可能原因：**
1. ❌ 网络连接问题
2. ❌ 币安API限流
3. ❌ 代理配置错误
4. ❌ 时间范围无效

**解决方法：**
1. 检查网络连接
2. 检查代理设置（`backend/.env`）
3. 缩短时间范围
4. 查看后端日志：`tail -f logs/rest_api.log`

### 进度不更新

**解决方法：**
1. 刷新页面
2. 检查后端服务是否运行
3. 查看浏览器控制台错误

### 数据库已满

**清理方法：**
```sql
-- 删除指定币种的数据
DELETE FROM klines WHERE symbol = 'BTCUSDT';

-- 删除指定时间范围的数据
DELETE FROM klines WHERE timestamp < 1609459200;

-- 删除所有数据
TRUNCATE klines;
```

---

## 📚 常见问题

### Q: 最多可以同时运行多少个下载任务？

A: 理论上无限制，但建议不超过5个并行任务，以避免API限流。

### Q: 下载的数据存储在哪里？

A: PostgreSQL数据库的 `klines` 表中。

### Q: 如何加快下载速度？

A: 
1. 使用更短的时间周期（如1h代替1m）
2. 缩短时间范围
3. 优化网络连接

### Q: 下载后的数据如何使用？

A: 
1. 用于策略回测
2. 在交易图表中展示
3. 导出用于其他分析工具

### Q: 支持哪些交易所？

A: 目前只支持币安（Binance），未来会支持更多交易所。

---

## 🎨 界面说明

### 任务状态颜色

| 状态 | 颜色 | 说明 |
|------|------|------|
| 等待中 | 🟡 黄色 | 任务已创建，等待开始 |
| 下载中 | 🔵 蓝色 | 正在下载数据 |
| 已完成 | 🟢 绿色 | 下载成功完成 |
| 失败 | 🔴 红色 | 下载出错 |
| 已取消 | ⚪ 灰色 | 用户手动取消 |

### 标签说明

- **币种标签**：蓝色，显示交易对
- **周期标签**：蓝色，显示时间周期
- **市场标签**：绿色，显示市场类型

---

## 🚦 下一步

完成数据下载后，你可以：

1. 📈 **切换到交易图表** - 查看下载的历史数据
2. 🔄 **运行回测** - 使用历史数据测试策略
3. 📊 **分析数据** - 导出数据进行深度分析

---

## 📞 技术支持

遇到问题？

1. 查看日志文件：`logs/rest_api.log`
2. 检查数据库连接
3. 提Issue到GitHub仓库

---

**Happy Trading! 📈💰**

