# æ•°æ®ä¿®å¤æ¨¡å¼è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ•°æ®ä¿®å¤ç³»ç»Ÿé‡‡ç”¨**å›ºå®šæ··åˆæ¨¡å¼**ï¼š
- **Kçº¿ä¿®å¤**ï¼šå›ºå®šæŒ‰æ—¶é—´ï¼ˆdays_backï¼‰
- **æŒ‡æ ‡ä¿®å¤**ï¼šå›ºå®šæŒ‰æ•°é‡ï¼ˆklines_countï¼‰

è¿™æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘çš„è®¾è®¡å†³ç­–ï¼Œä¸æ˜¯å¯é€‰çš„ã€‚

---

## ğŸ”‘ æ ¸å¿ƒåŒºåˆ«

### Kçº¿ä¿®å¤ vs æŒ‡æ ‡ä¿®å¤

| ç»´åº¦ | Kçº¿ä¿®å¤ | æŒ‡æ ‡ä¿®å¤ |
|------|--------|---------|
| **å›ºå®šæ¨¡å¼** | **æŒ‰æ—¶é—´** | **æŒ‰æ•°é‡** |
| **æ•°æ®æº** | äº¤æ˜“æ‰€ APIï¼ˆå¤–éƒ¨ï¼‰ | æœ¬åœ°Kçº¿æ•°æ®ï¼ˆå†…éƒ¨ï¼‰ |
| **ç¼ºå¤±åŸå› ** | ç³»ç»Ÿæ•…éšœã€ç½‘ç»œä¸­æ–­ | è®¡ç®—é—æ¼ã€ç¨‹åºbug |
| **ä¿®å¤æ–¹å¼** | ä»äº¤æ˜“æ‰€æ‹‰å–å†å²æ•°æ® | åŸºäºå·²æœ‰Kçº¿è®¡ç®— |
| **å‚æ•°** | `days_back` | `klines_count` |
| **APIé™åˆ¶** | `fetch_klines(start_time, end_time)` | æœ¬åœ°è®¡ç®—ï¼Œæ— APIé™åˆ¶ |

---

## ğŸ’¡ ä¸ºä»€ä¹ˆKçº¿ä¿®å¤ä¸é€‚åˆæŒ‰æ•°é‡ï¼Ÿ

### 1. äº¤æ˜“æ‰€APIçš„é™åˆ¶

**äº¤æ˜“æ‰€APIæ˜¯æŒ‰æ—¶é—´èŒƒå›´å·¥ä½œçš„ï¼š**
```python
# Binance API
exchange.fetch_klines(
    symbol='BTCUSDT',
    interval='1d',
    start_time=1640995200000,  # å¿…é¡»æŒ‡å®šå¼€å§‹æ—¶é—´
    end_time=1672531200000,     # å¿…é¡»æŒ‡å®šç»“æŸæ—¶é—´
    limit=1000
)
```

**ä¸èƒ½è¿™æ ·è°ƒç”¨ï¼š**
```python
# âŒ è¿™æ ·çš„APIä¸å­˜åœ¨
exchange.fetch_klines(
    symbol='BTCUSDT',
    interval='1d',
    count=2000  # "ç»™æˆ‘2000æ ¹Kçº¿"
)
```

### 2. æ—¶é—´è¯­ä¹‰ä¸æ˜ç¡®

**æŒ‰æ•°é‡æ£€æµ‹çš„é—®é¢˜ï¼š**
```python
# åœºæ™¯ï¼šæ•°æ®åº“æœ‰311æ ¹1d Kçº¿ï¼ŒæœŸæœ›2000æ ¹
klines_count = 2000
current_count = 311
missing_count = 1689  # ç¼ºå°‘1689æ ¹

é—®é¢˜ï¼š
â“ è¿™1689æ ¹åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹ï¼Ÿ
â“ æ˜¯2025å¹´ä¹‹å‰çš„ï¼Ÿè¿˜æ˜¯2024å¹´çš„ï¼Ÿè¿˜æ˜¯2020å¹´çš„ï¼Ÿ
â“ å¦‚ä½•å‘Šè¯‰äº¤æ˜“æ‰€APIè¦è·å–å“ªä¸ªæ—¶é—´æ®µçš„æ•°æ®ï¼Ÿ
â“ äº¤æ˜“æ‰€æœ‰è¿™ä¹ˆä¹…è¿œçš„å†å²æ•°æ®å—ï¼Ÿï¼ˆ5.5å¹´ï¼‰
```

### 3. ä¸åŒå‘¨æœŸçš„æ—¶é—´è·¨åº¦å·®å¼‚å·¨å¤§

**æŒ‰æ•°é‡çš„æ—¶é—´è·¨åº¦ï¼š**
```
2000æ ¹Kçº¿å¯¹åº”çš„æ—¶é—´ï¼š
- 1d:  2000å¤© = 5.5å¹´
- 4h:  2000Ã—4å°æ—¶ = 333å¤©
- 1h:  2000å°æ—¶ = 83å¤©
- 3m:  2000Ã—3åˆ†é’Ÿ = 4å¤©
```

**é—®é¢˜ï¼š**
- 1då‘¨æœŸéœ€è¦5.5å¹´å†å²ï¼Œäº¤æ˜“æ‰€å¯èƒ½æ²¡æœ‰
- 3må‘¨æœŸåªéœ€è¦4å¤©å†å²ï¼Œå¾ˆå®¹æ˜“è·å–
- æŒ‰æ•°é‡æ— æ³•ç»Ÿä¸€å¤„ç†

### 4. ä¸šåŠ¡æ„ä¹‰ä¸å¤§

**å®æ—¶äº¤æ˜“ç³»ç»Ÿé€šå¸¸åªå…³å¿ƒæœ€è¿‘çš„æ•°æ®ï¼š**
```python
# æœ‰æ„ä¹‰ï¼šæ£€æŸ¥æœ€è¿‘30å¤©çš„Kçº¿æ˜¯å¦å®Œæ•´
days_back = 30  âœ…

# æ„ä¹‰ä¸å¤§ï¼šæ£€æŸ¥æœ€è¿‘2000æ ¹1d Kçº¿ï¼ˆ5.5å¹´å‰çš„æ•°æ®ï¼‰
klines_count = 2000  â“ ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆä¹…è¿œçš„æ•°æ®ï¼Ÿ
```

---

## âœ… ä¸ºä»€ä¹ˆæŒ‡æ ‡ä¿®å¤å›ºå®šæŒ‰æ•°é‡ï¼Ÿ

### 1. æ•°æ®æºæ˜¯æœ¬åœ°çš„

**æŒ‡æ ‡è®¡ç®—ä¸ä¾èµ–å¤–éƒ¨APIï¼š**
```python
# æŒ‡æ ‡ä¿®å¤æµç¨‹
1. ä»æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢æœ€è¿‘2000æ ¹Kçº¿  â† æœ¬åœ°æœ‰
2. éå†è¿™äº›Kçº¿ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æŒ‡æ ‡
3. ç¼ºå¤±çš„å°±åŸºäºKçº¿è®¡ç®—æŒ‡æ ‡  â† æœ¬åœ°è®¡ç®—
4. ä¿å­˜åˆ°æ•°æ®åº“
```

### 2. ç»Ÿä¸€æ ·æœ¬é‡

**å›ºå®šæŒ‰æ•°é‡ç¡®ä¿å›æµ‹å…¬å¹³ï¼š**
```python
# å›ºå®šæ•°é‡ï¼šç¡®ä¿æ¯ä¸ªå‘¨æœŸéƒ½æœ‰ç›¸åŒæ•°é‡çš„æŒ‡æ ‡
klines_count = 2000

æ•ˆæœï¼š
  1d: 2000æ ¹æŒ‡æ ‡
  1h: 2000æ ¹æŒ‡æ ‡
  3m: 2000æ ¹æŒ‡æ ‡

â†’ æ ·æœ¬é‡ç»Ÿä¸€ï¼Œå›æµ‹å¯¹æ¯”å…¬å¹³
â†’ ç­–ç•¥å¼€å‘æ—¶ï¼Œæ§åˆ¶å˜é‡ä¸€è‡´
```

### 3. æ— å¤–éƒ¨ä¾èµ–

```python
# æŒ‡æ ‡è®¡ç®—ç¤ºä¾‹
klines = db.get_recent_klines(limit=2000)

for kline in klines:
    if not db.has_indicator(kline.timestamp):
        # æœ¬åœ°è®¡ç®—ï¼Œä¸éœ€è¦è°ƒç”¨äº¤æ˜“æ‰€
        indicator = calculate_indicators(kline)
        db.save_indicator(indicator)
```

---

## ğŸ“Š å®é™…åœºæ™¯å¯¹æ¯”

### åœºæ™¯1ï¼šæŒ‰æ—¶é—´ä¿®å¤Kçº¿ï¼ˆæ­£å¸¸ï¼‰âœ…

```python
# é—®é¢˜ï¼šç³»ç»Ÿåœ¨ 2025-10-20 åˆ° 2025-10-25 æœŸé—´åœæœº
æ•°æ®åº“Kçº¿ï¼š2025-01-01 ~ 2025-10-20ï¼Œ2025-10-26 ~ ç°åœ¨
ç¼ºå¤±ï¼š2025-10-21 ~ 2025-10-25ï¼ˆ5å¤©ï¼‰

# æ£€æµ‹
days_back = 30
detect_kline_gaps(days_back=30)
â†’ å‘ç°æ—¶é—´ç¼ºå£ï¼š2025-10-21 åˆ° 2025-10-25

# ä¿®å¤
exchange.fetch_klines(
    start_time='2025-10-21 00:00',  # æ˜ç¡®çš„æ—¶é—´
    end_time='2025-10-25 23:59'     # æ˜ç¡®çš„æ—¶é—´
)
âœ… è¡¥å……5å¤©çš„Kçº¿ï¼Œæ—¶é—´è¿ç»­æ€§æ¢å¤
```

---

### åœºæ™¯2ï¼šæŒ‰æ•°é‡ä¿®å¤Kçº¿ï¼ˆæœ‰é—®é¢˜ï¼‰âŒ

```python
# é—®é¢˜ï¼šæ•°æ®åº“åªæœ‰311æ ¹1d Kçº¿
æ•°æ®åº“Kçº¿ï¼š311æ ¹ï¼ˆä» 2025-01-02 å¼€å§‹ï¼‰
æœŸæœ›ï¼š2000æ ¹

# æ£€æµ‹
klines_count = 2000
detect_kline_gaps(klines_count=2000)
â†’ ç¼ºå°‘ 1689 æ ¹

# ä¿®å¤ï¼Ÿ
âŒ é—®é¢˜1ï¼šè¿™1689æ ¹åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹ï¼Ÿ
   - 2024å¹´çš„ï¼Ÿ2023å¹´çš„ï¼Ÿ2020å¹´çš„ï¼Ÿ

âŒ é—®é¢˜2ï¼šå¦‚ä½•è°ƒç”¨äº¤æ˜“æ‰€APIï¼Ÿ
   exchange.fetch_klines(
       start_time=????,  # ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹
       end_time=????     # ä¸çŸ¥é“åˆ°ä»€ä¹ˆæ—¶å€™ç»“æŸ
   )

âŒ é—®é¢˜3ï¼šäº¤æ˜“æ‰€æœ‰è¿™ä¹ˆå¤šå†å²æ•°æ®å—ï¼Ÿ
   - 2000æ ¹1d = 5.5å¹´å†å²
   - Binanceå¯èƒ½åªä¿ç•™1-2å¹´çš„1dæ•°æ®

âŒ é—®é¢˜4ï¼šè¿™äº›ä¹…è¿œçš„æ•°æ®æœ‰ç”¨å—ï¼Ÿ
   - å®æ—¶äº¤æ˜“ç³»ç»Ÿé€šå¸¸åªéœ€è¦æœ€è¿‘å‡ ä¸ªæœˆçš„æ•°æ®
```

---

### åœºæ™¯3ï¼šæŒ‰æ•°é‡ä¿®å¤æŒ‡æ ‡ï¼ˆæ­£å¸¸ï¼‰âœ…

```python
# é—®é¢˜ï¼šæŒ‡æ ‡è®¡ç®—é—æ¼ï¼Œåªæœ‰éƒ¨åˆ†æŒ‡æ ‡
æ•°æ®åº“Kçº¿ï¼š311æ ¹1d Kçº¿ï¼ˆå®Œæ•´ï¼‰
æ•°æ®åº“æŒ‡æ ‡ï¼š30ä¸ªæŒ‡æ ‡ï¼ˆéƒ¨åˆ†é—æ¼ï¼‰
æœŸæœ›ï¼šæ‰€æœ‰Kçº¿éƒ½æœ‰æŒ‡æ ‡

# æ£€æµ‹
klines_count = 2000
detect_indicator_gaps(klines_count=2000)
â†’ Kçº¿æœ‰311æ ¹ï¼ŒæŒ‡æ ‡æœ‰30ä¸ªï¼Œç¼ºå°‘281ä¸ª

# ä¿®å¤
klines = db.get_recent_klines(limit=2000)  # è·å–æœ€è¿‘2000æ ¹ï¼ˆå®é™…311æ ¹ï¼‰
for kline in klines:
    if not db.has_indicator(kline.timestamp):
        # åŸºäºKçº¿æœ¬åœ°è®¡ç®—æŒ‡æ ‡
        indicator = calculate_indicators(kline)
        db.save_indicator(indicator)

âœ… è¡¥å……281ä¸ªæŒ‡æ ‡ï¼Œæ‰€æœ‰Kçº¿éƒ½æœ‰æŒ‡æ ‡äº†
```

---

## ğŸ¯ é…ç½®è¯´æ˜

### å›ºå®šæ··åˆæ¨¡å¼ï¼ˆå”¯ä¸€æ¨¡å¼ï¼‰

```python
# config.py
repair_days_back = 30        # Kçº¿ä¿®å¤ï¼šå›ºå®šæŒ‰æ—¶é—´ï¼ˆ30å¤©ï¼‰
repair_klines_count = 2000   # æŒ‡æ ‡ä¿®å¤ï¼šå›ºå®šæŒ‰æ•°é‡ï¼ˆ2000æ ¹ï¼‰

# æ•ˆæœ
Kçº¿ï¼š
  æ‰€æœ‰å‘¨æœŸéƒ½æ£€æŸ¥æœ€è¿‘30å¤©çš„æ—¶é—´è¿ç»­æ€§
  
æŒ‡æ ‡ï¼š
  1d:  2000 æ ¹æŒ‡æ ‡ï¼ˆ5.5å¹´ï¼‰
  1h:  2000 æ ¹æŒ‡æ ‡ï¼ˆ83å¤©ï¼‰
  3m:  2000 æ ¹æŒ‡æ ‡ï¼ˆ4å¤©ï¼‰

# åŸç†
âœ… Kçº¿æ—¶é—´è¿ç»­æ€§æœ‰ä¿éšœï¼ˆæŒ‰æ—¶é—´ï¼‰
âœ… æŒ‡æ ‡æ ·æœ¬é‡ç»Ÿä¸€å…¬å¹³ï¼ˆæŒ‰æ•°é‡ï¼‰
âœ… å…¼é¡¾ç”Ÿäº§ç¨³å®šæ€§å’Œå›æµ‹éœ€æ±‚
```

### å¯åŠ¨æ—¶å¿«é€Ÿæ£€æŸ¥

```python
# èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
repair_hours_back_on_startup = 1  # æœ€è¿‘1å°æ—¶

# Kçº¿ä¿®å¤ï¼š1å°æ—¶ï¼ˆæŒ‰æ—¶é—´ï¼‰
# æŒ‡æ ‡ä¿®å¤ï¼š2000æ ¹ï¼ˆæŒ‰æ•°é‡ï¼‰

# æ•ˆæœ
å¿«é€Ÿæ£€æŸ¥æœ€è¿‘æ—¶æ®µçš„Kçº¿å®Œæ•´æ€§
ç¡®ä¿2000æ ¹æŒ‡æ ‡æ•°æ®å¯ç”¨

# ä¼˜åŠ¿
âœ… å¿«é€Ÿå¯åŠ¨
âœ… Kçº¿æ£€æŸ¥æœ€è¿‘æ—¶æ®µ
âœ… æŒ‡æ ‡ä¿æŒç»Ÿä¸€æ ·æœ¬é‡
```

---

## ğŸ”§ ä»£ç å®ç°é€»è¾‘

### Kçº¿ä¿®å¤ï¼šå¿…é¡»æŒ‰æ—¶é—´

```python
async def detect_kline_gaps(days_back: float):
    """Kçº¿ç¼ºå¤±æ£€æµ‹ï¼ˆåªæ”¯æŒæŒ‰æ—¶é—´ï¼‰"""
    # è®¡ç®—æ—¶é—´èŒƒå›´
    end_time = int(datetime.now().timestamp())
    start_time = end_time - int(days_back * 86400)
    
    # ç”ŸæˆæœŸæœ›çš„æ—¶é—´æˆ³åºåˆ—
    expected_timestamps = generate_expected_timestamps(
        start_time, end_time, interval
    )
    
    # è·å–æ•°æ®åº“ä¸­çš„Kçº¿
    existing_klines = db.get_klines_in_range(start_time, end_time)
    existing_timestamps = {k.timestamp for k in existing_klines}
    
    # æ‰¾å‡ºç¼ºå¤±çš„æ—¶é—´æ®µ
    missing = expected_timestamps - existing_timestamps
    
    return missing

async def backfill_klines(missing_timestamps):
    """ä»äº¤æ˜“æ‰€è¡¥å……Kçº¿"""
    for timestamp in missing_timestamps:
        # è°ƒç”¨äº¤æ˜“æ‰€APIï¼ŒæŒ‡å®šæ˜ç¡®çš„æ—¶é—´
        klines = exchange.fetch_klines(
            start_time=timestamp,
            end_time=timestamp + interval
        )
        db.save_klines(klines)
```

### æŒ‡æ ‡ä¿®å¤ï¼šå›ºå®šæŒ‰æ•°é‡

```python
async def detect_indicator_gaps(
    symbol: str,
    timeframe: str,
    klines_count: int,
    market_type: str = 'spot'
) -> List[int]:
    """æŒ‡æ ‡ç¼ºå¤±æ£€æµ‹ï¼ˆå›ºå®šæŒ‰æ•°é‡ï¼‰"""
    
    # 1. è·å–æœ€è¿‘ N æ ¹Kçº¿çš„æ—¶é—´æˆ³ï¼ˆåŸºå‡†ï¼‰
    klines = await db.get_recent_klines(
        symbol, timeframe, 
        limit=klines_count,
        market_type=market_type
    )
    kline_timestamps = {k.timestamp for k in klines}
    
    if not kline_timestamps:
        return []
    
    # 2. è·å–å·²æœ‰çš„æŒ‡æ ‡
    indicators = await db.get_recent_indicators(
        symbol, timeframe, 
        limit=klines_count,
        market_type=market_type
    )
    indicator_timestamps = {i.timestamp for i in indicators}
    
    # 3. æ‰¾å‡ºæœ‰Kçº¿ä½†æ²¡æŒ‡æ ‡çš„
    missing = sorted(kline_timestamps - indicator_timestamps)
    
    return missing

async def backfill_indicators(
    symbol: str,
    timeframe: str, 
    missing_timestamps: List[int],
    market_type: str = 'spot'
) -> int:
    """æœ¬åœ°è®¡ç®—æŒ‡æ ‡"""
    filled = 0
    
    for timestamp in missing_timestamps:
        # è·å–è¯¥æ—¶é—´ç‚¹ä¹‹å‰çš„Kçº¿ï¼ˆç”¨äºè®¡ç®—æŒ‡æ ‡ï¼‰
        klines_before = await db.get_klines_before(
            symbol, timeframe, timestamp,
            limit=max_required_klines,
            market_type=market_type
        )
        
        # æœ¬åœ°è®¡ç®—æŒ‡æ ‡ï¼ˆä¸éœ€è¦äº¤æ˜“æ‰€APIï¼‰
        indicator = calculate_indicators(klines_before)
        
        if indicator:
            await db.insert_indicator(indicator)
            filled += 1
    
    return filled
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æŒ‰æ—¶é—´ä¿®å¤ 30å¤©

```
Kçº¿ä¿®å¤ï¼š
- æ£€æµ‹ï¼šæ‰«æ30å¤©æ—¶é—´èŒƒå›´
- ä¿®å¤ï¼šè°ƒç”¨äº¤æ˜“æ‰€APIï¼ˆå¦‚æœ‰ç¼ºå¤±ï¼‰
- æ—¶é—´ï¼šå–å†³äºç½‘ç»œå’Œäº¤æ˜“æ‰€å“åº”

æŒ‡æ ‡ä¿®å¤ï¼š
- 1d:  30 ä¸ªæŒ‡æ ‡ï¼ˆ< 1ç§’ï¼‰
- 1h:  720 ä¸ªæŒ‡æ ‡ï¼ˆ< 10ç§’ï¼‰
- 3m:  14400 ä¸ªæŒ‡æ ‡ï¼ˆ~3åˆ†é’Ÿï¼‰
```

### æŒ‰æ•°é‡ä¿®å¤ 2000æ ¹

```
Kçº¿ä¿®å¤ï¼š
- âŒ ä¸æ”¯æŒ

æŒ‡æ ‡ä¿®å¤ï¼š
- 1d:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- 1h:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- 3m:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- âœ… æ‰€æœ‰å‘¨æœŸè€—æ—¶ç›¸åŒ
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®ä¸è¶³æ—¶çš„è¡Œä¸º

```python
# æŒ‡æ ‡ä¿®å¤ï¼šæœŸæœ›2000æ ¹ï¼Œä½†æ•°æ®åº“åªæœ‰311æ ¹
klines_count = 2000
actual_klines = 311

è¡Œä¸ºï¼š
â†’ è·å–å…¨éƒ¨311æ ¹Kçº¿
â†’ æ£€æµ‹å’Œä¿®å¤è¿™311æ ¹çš„æŒ‡æ ‡
â†’ ä¸ä¼šæŠ¥é”™
â†’ æ—¥å¿—æ˜¾ç¤ºï¼š
   "K-lines in range: 311"
   "Missing indicators: X"
```

### 2. å‚æ•°è°ƒæ•´å»ºè®®

```python
# æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´å‚æ•°
repair_days_back = 30        # Kçº¿ï¼š30å¤©å¤Ÿç”¨å—ï¼Ÿ
repair_klines_count = 2000   # æŒ‡æ ‡ï¼š2000æ ¹å¤Ÿç”¨å—ï¼Ÿ

# å¿«é€Ÿæ£€æŸ¥
repair_hours_back_on_startup = 1  # èŠ‚ç‚¹å¯åŠ¨æ—¶æ£€æŸ¥1å°æ—¶

# ç¤ºä¾‹é…ç½®
# è½»é‡çº§ï¼š7å¤© + 500æ ¹
repair_days_back = 7
repair_klines_count = 500

# æ ‡å‡†ï¼š30å¤© + 2000æ ¹ï¼ˆæ¨èï¼‰
repair_days_back = 30
repair_klines_count = 2000

# é‡é‡çº§ï¼š90å¤© + 5000æ ¹
repair_days_back = 90
repair_klines_count = 5000
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™ï¼ˆå›ºå®šï¼‰

**Kçº¿ä¿®å¤ = å¤–éƒ¨æ•°æ®åŒæ­¥ â†’ å›ºå®šæŒ‰æ—¶é—´**
- æ•°æ®æ¥è‡ªäº¤æ˜“æ‰€API
- APIè¦æ±‚æ—¶é—´èŒƒå›´
- æ—¶é—´ç¼ºå£æœ‰æ˜ç¡®è¯­ä¹‰
- **å‚æ•°ï¼š`days_back`**

**æŒ‡æ ‡ä¿®å¤ = æœ¬åœ°æ•°æ®è®¡ç®— â†’ å›ºå®šæŒ‰æ•°é‡**
- æ•°æ®æ¥è‡ªæœ¬åœ°Kçº¿
- æœ¬åœ°è®¡ç®—ï¼Œæ— APIé™åˆ¶
- æ ·æœ¬é‡ç»Ÿä¸€ï¼Œå›æµ‹å…¬å¹³
- **å‚æ•°ï¼š`klines_count`**

### å›ºå®šé…ç½®

```python
# å”¯ä¸€æ¨¡å¼ï¼ˆå›ºå®šæ··åˆï¼‰
repair_days_back = 30        # Kçº¿ï¼šå›ºå®šæŒ‰æ—¶é—´ï¼ˆ30å¤©ï¼‰
repair_klines_count = 2000   # æŒ‡æ ‡ï¼šå›ºå®šæŒ‰æ•°é‡ï¼ˆ2000æ ¹ï¼‰

# èŠ‚ç‚¹å¯åŠ¨æ—¶çš„å¿«é€Ÿæ£€æŸ¥
repair_hours_back_on_startup = 1  # Kçº¿æ£€æŸ¥1å°æ—¶ï¼ŒæŒ‡æ ‡ä»ç„¶2000æ ¹

# ä½¿ç”¨æ–¹å¼
# 1. èŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ
python -m app.main kline --symbols BTCUSDT --timeframes 1h,3m
â†’ Kçº¿ï¼šæ£€æŸ¥æœ€è¿‘1å°æ—¶ï¼ˆæŒ‰æ—¶é—´ï¼‰
â†’ æŒ‡æ ‡ï¼šæ£€æŸ¥æœ€è¿‘2000æ ¹ï¼ˆæŒ‰æ•°é‡ï¼‰

# 2. æ‰‹åŠ¨æ·±åº¦ä¿®å¤
./scripts/repair_data.sh "BTCUSDT" "1h,3m"
â†’ Kçº¿ï¼šæ£€æŸ¥æœ€è¿‘30å¤©ï¼ˆæŒ‰æ—¶é—´ï¼‰
â†’ æŒ‡æ ‡ï¼šæ£€æŸ¥æœ€è¿‘2000æ ¹ï¼ˆæŒ‰æ•°é‡ï¼‰
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

| æ–¹é¢ | åŸå›  |
|------|------|
| **Kçº¿æŒ‰æ—¶é—´** | ç¡®ä¿æ—¶é—´è¿ç»­æ€§ï¼Œé¿å…äº¤æ˜“æ‰€æ•°æ®ç¼ºå¤± |
| **æŒ‡æ ‡æŒ‰æ•°é‡** | æ ·æœ¬é‡ç»Ÿä¸€ï¼Œå›æµ‹å¯¹æ¯”å…¬å¹³ |
| **å›ºå®šæ¨¡å¼** | ç®€åŒ–é€»è¾‘ï¼Œé¿å…é…ç½®æ··ä¹± |
| **ä¸å¯æ›´æ”¹** | ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æ¶æ„å†³ç­– |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æŒ‡æ ‡å…ƒæ•°æ®é…ç½®](./indicator-metadata.md)
- [æŒ‡æ ‡æ”¹è¿›æŠ¥å‘Š](./indicator-improvement-report.md)
- [æ•°æ®å®Œæ•´æ€§æœåŠ¡](../backend/app/services/data_integrity.py)

---

**æœ€åæ›´æ–°ï¼š** 2025-11-08
**ç‰ˆæœ¬ï¼š** v3.0 - å›ºå®šæ··åˆæ¨¡å¼ï¼ˆKçº¿å›ºå®šæŒ‰æ—¶é—´ + æŒ‡æ ‡å›ºå®šæŒ‰æ•°é‡ï¼‰

