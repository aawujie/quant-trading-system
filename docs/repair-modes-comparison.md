# æ•°æ®ä¿®å¤æ¨¡å¼å¯¹æ¯”ï¼šæŒ‰æ—¶é—´ vs æŒ‰æ•°é‡

## ğŸ“‹ æ¦‚è¿°

æ•°æ®ä¿®å¤ç³»ç»Ÿæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š
- **æŒ‰æ—¶é—´ä¿®å¤**ï¼šæ£€æŸ¥æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ•°æ®å®Œæ•´æ€§
- **æŒ‰æ•°é‡ä¿®å¤**ï¼šæ£€æŸ¥æœ€è¿‘Næ ¹Kçº¿çš„æ•°æ®å®Œæ•´æ€§

ä½†å¹¶éæ‰€æœ‰ä¿®å¤ç±»å‹éƒ½é€‚ç”¨ä¸¤ç§æ¨¡å¼ã€‚

---

## ğŸ”‘ æ ¸å¿ƒåŒºåˆ«

### Kçº¿ä¿®å¤ vs æŒ‡æ ‡ä¿®å¤

| ç»´åº¦ | Kçº¿ä¿®å¤ | æŒ‡æ ‡ä¿®å¤ |
|------|--------|---------|
| **æ•°æ®æº** | äº¤æ˜“æ‰€ APIï¼ˆå¤–éƒ¨ï¼‰ | æœ¬åœ°Kçº¿æ•°æ®ï¼ˆå†…éƒ¨ï¼‰ |
| **æŒ‰æ—¶é—´** | âœ… åˆç† | âœ… åˆç† |
| **æŒ‰æ•°é‡** | âŒ ä¸åˆç† | âœ… åˆç† |
| **ç¼ºå¤±åŸå› ** | ç³»ç»Ÿæ•…éšœã€ç½‘ç»œä¸­æ–­ | è®¡ç®—é—æ¼ã€ç¨‹åºbug |
| **ä¿®å¤æ–¹å¼** | ä»äº¤æ˜“æ‰€æ‹‰å–å†å²æ•°æ® | åŸºäºå·²æœ‰Kçº¿è®¡ç®— |
| **æ—¶é—´è¯­ä¹‰** | å¿…é¡»æ˜ç¡®æ—¶é—´èŒƒå›´ | å¯ä»¥åªå…³å¿ƒæ•°é‡ |
| **APIé™åˆ¶** | `fetch_klines(start_time, end_time)` | æœ¬åœ°è®¡ç®—ï¼Œæ— APIé™åˆ¶ |

---

## ğŸ’¡ ä¸ºä»€ä¹ˆKçº¿ä¿®å¤ä¸é€‚åˆæŒ‰æ•°é‡ï¼Ÿ

### 1. äº¤æ˜“æ‰€APIçš„é™åˆ¶

**äº¤æ˜“æ‰€APIæ˜¯æŒ‰æ—¶é—´èŒƒå›´å·¥ä½œçš„ï¼š**
```python
# Binance API
exchange.fetch_klines(
    symbol='BTCUSDT',
    interval='1d',
    start_time=1640995200000,  # å¿…é¡»æŒ‡å®šå¼€å§‹æ—¶é—´
    end_time=1672531200000,     # å¿…é¡»æŒ‡å®šç»“æŸæ—¶é—´
    limit=1000
)
```

**ä¸èƒ½è¿™æ ·è°ƒç”¨ï¼š**
```python
# âŒ è¿™æ ·çš„APIä¸å­˜åœ¨
exchange.fetch_klines(
    symbol='BTCUSDT',
    interval='1d',
    count=2000  # "ç»™æˆ‘2000æ ¹Kçº¿"
)
```

### 2. æ—¶é—´è¯­ä¹‰ä¸æ˜ç¡®

**æŒ‰æ•°é‡æ£€æµ‹çš„é—®é¢˜ï¼š**
```python
# åœºæ™¯ï¼šæ•°æ®åº“æœ‰311æ ¹1d Kçº¿ï¼ŒæœŸæœ›2000æ ¹
klines_count = 2000
current_count = 311
missing_count = 1689  # ç¼ºå°‘1689æ ¹

é—®é¢˜ï¼š
â“ è¿™1689æ ¹åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹ï¼Ÿ
â“ æ˜¯2025å¹´ä¹‹å‰çš„ï¼Ÿè¿˜æ˜¯2024å¹´çš„ï¼Ÿè¿˜æ˜¯2020å¹´çš„ï¼Ÿ
â“ å¦‚ä½•å‘Šè¯‰äº¤æ˜“æ‰€APIè¦è·å–å“ªä¸ªæ—¶é—´æ®µçš„æ•°æ®ï¼Ÿ
â“ äº¤æ˜“æ‰€æœ‰è¿™ä¹ˆä¹…è¿œçš„å†å²æ•°æ®å—ï¼Ÿï¼ˆ5.5å¹´ï¼‰
```

### 3. ä¸åŒå‘¨æœŸçš„æ—¶é—´è·¨åº¦å·®å¼‚å·¨å¤§

**æŒ‰æ•°é‡çš„æ—¶é—´è·¨åº¦ï¼š**
```
2000æ ¹Kçº¿å¯¹åº”çš„æ—¶é—´ï¼š
- 1d:  2000å¤© = 5.5å¹´
- 4h:  2000Ã—4å°æ—¶ = 333å¤©
- 1h:  2000å°æ—¶ = 83å¤©
- 3m:  2000Ã—3åˆ†é’Ÿ = 4å¤©
```

**é—®é¢˜ï¼š**
- 1då‘¨æœŸéœ€è¦5.5å¹´å†å²ï¼Œäº¤æ˜“æ‰€å¯èƒ½æ²¡æœ‰
- 3må‘¨æœŸåªéœ€è¦4å¤©å†å²ï¼Œå¾ˆå®¹æ˜“è·å–
- æŒ‰æ•°é‡æ— æ³•ç»Ÿä¸€å¤„ç†

### 4. ä¸šåŠ¡æ„ä¹‰ä¸å¤§

**å®æ—¶äº¤æ˜“ç³»ç»Ÿé€šå¸¸åªå…³å¿ƒæœ€è¿‘çš„æ•°æ®ï¼š**
```python
# æœ‰æ„ä¹‰ï¼šæ£€æŸ¥æœ€è¿‘30å¤©çš„Kçº¿æ˜¯å¦å®Œæ•´
days_back = 30  âœ…

# æ„ä¹‰ä¸å¤§ï¼šæ£€æŸ¥æœ€è¿‘2000æ ¹1d Kçº¿ï¼ˆ5.5å¹´å‰çš„æ•°æ®ï¼‰
klines_count = 2000  â“ ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆä¹…è¿œçš„æ•°æ®ï¼Ÿ
```

---

## âœ… ä¸ºä»€ä¹ˆæŒ‡æ ‡ä¿®å¤å¯ä»¥æŒ‰æ•°é‡ï¼Ÿ

### 1. æ•°æ®æºæ˜¯æœ¬åœ°çš„

**æŒ‡æ ‡è®¡ç®—ä¸ä¾èµ–å¤–éƒ¨APIï¼š**
```python
# æŒ‡æ ‡ä¿®å¤æµç¨‹
1. ä»æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢æœ€è¿‘2000æ ¹Kçº¿  â† æœ¬åœ°æœ‰
2. éå†è¿™äº›Kçº¿ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æŒ‡æ ‡
3. ç¼ºå¤±çš„å°±åŸºäºKçº¿è®¡ç®—æŒ‡æ ‡  â† æœ¬åœ°è®¡ç®—
4. ä¿å­˜åˆ°æ•°æ®åº“
```

### 2. çµæ´»æ€§é«˜

**å¯ä»¥æŒ‰æ—¶é—´æˆ–æ•°é‡ï¼Œéƒ½æœ‰æ˜ç¡®è¯­ä¹‰ï¼š**
```python
# æŒ‰æ—¶é—´ï¼šç¡®ä¿æœ€è¿‘30å¤©çš„æŒ‡æ ‡å®Œæ•´
days_back = 30
â†’ é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œç¡®ä¿æ—¶é—´è¿ç»­æ€§

# æŒ‰æ•°é‡ï¼šç¡®ä¿æ¯ä¸ªå‘¨æœŸéƒ½æœ‰2000ä¸ªæŒ‡æ ‡
klines_count = 2000
â†’ é€‚åˆå›æµ‹å’Œç­–ç•¥å¼€å‘ï¼Œæ•°é‡ä¸€è‡´æ›´å…¬å¹³
```

### 3. å›æµ‹å‹å¥½

**ç­–ç•¥å¼€å‘æ—¶ï¼Œç›¸åŒæ•°é‡æ›´åˆç†ï¼š**
```python
# å›æµ‹åœºæ™¯ï¼šå¯¹æ¯”ä¸åŒå‘¨æœŸçš„ç­–ç•¥è¡¨ç°
ç­–ç•¥Aåœ¨1då‘¨æœŸï¼šç”¨2000æ ¹Kçº¿å›æµ‹ = 5.5å¹´
ç­–ç•¥Båœ¨1hå‘¨æœŸï¼šç”¨2000æ ¹Kçº¿å›æµ‹ = 83å¤©

è™½ç„¶æ—¶é—´è·¨åº¦ä¸åŒï¼Œä½†ï¼š
âœ… æ ·æœ¬é‡ç›¸åŒï¼ˆéƒ½æ˜¯2000ä¸ªäº¤æ˜“ç‚¹ï¼‰
âœ… ç»Ÿè®¡æ„ä¹‰ç›¸å½“
âœ… å¯¹æ¯”æ›´å…¬å¹³
```

### 4. æ— å¤–éƒ¨ä¾èµ–

```python
# æŒ‡æ ‡è®¡ç®—ç¤ºä¾‹
klines = db.get_recent_klines(limit=2000)

for kline in klines:
    if not db.has_indicator(kline.timestamp):
        # æœ¬åœ°è®¡ç®—ï¼Œä¸éœ€è¦è°ƒç”¨äº¤æ˜“æ‰€
        indicator = calculate_indicators(kline)
        db.save_indicator(indicator)
```

---

## ğŸ“Š å®é™…åœºæ™¯å¯¹æ¯”

### åœºæ™¯1ï¼šæŒ‰æ—¶é—´ä¿®å¤Kçº¿ï¼ˆæ­£å¸¸ï¼‰âœ…

```python
# é—®é¢˜ï¼šç³»ç»Ÿåœ¨ 2025-10-20 åˆ° 2025-10-25 æœŸé—´åœæœº
æ•°æ®åº“Kçº¿ï¼š2025-01-01 ~ 2025-10-20ï¼Œ2025-10-26 ~ ç°åœ¨
ç¼ºå¤±ï¼š2025-10-21 ~ 2025-10-25ï¼ˆ5å¤©ï¼‰

# æ£€æµ‹
days_back = 30
detect_kline_gaps(days_back=30)
â†’ å‘ç°æ—¶é—´ç¼ºå£ï¼š2025-10-21 åˆ° 2025-10-25

# ä¿®å¤
exchange.fetch_klines(
    start_time='2025-10-21 00:00',  # æ˜ç¡®çš„æ—¶é—´
    end_time='2025-10-25 23:59'     # æ˜ç¡®çš„æ—¶é—´
)
âœ… è¡¥å……5å¤©çš„Kçº¿ï¼Œæ—¶é—´è¿ç»­æ€§æ¢å¤
```

---

### åœºæ™¯2ï¼šæŒ‰æ•°é‡ä¿®å¤Kçº¿ï¼ˆæœ‰é—®é¢˜ï¼‰âŒ

```python
# é—®é¢˜ï¼šæ•°æ®åº“åªæœ‰311æ ¹1d Kçº¿
æ•°æ®åº“Kçº¿ï¼š311æ ¹ï¼ˆä» 2025-01-02 å¼€å§‹ï¼‰
æœŸæœ›ï¼š2000æ ¹

# æ£€æµ‹
klines_count = 2000
detect_kline_gaps(klines_count=2000)
â†’ ç¼ºå°‘ 1689 æ ¹

# ä¿®å¤ï¼Ÿ
âŒ é—®é¢˜1ï¼šè¿™1689æ ¹åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹ï¼Ÿ
   - 2024å¹´çš„ï¼Ÿ2023å¹´çš„ï¼Ÿ2020å¹´çš„ï¼Ÿ

âŒ é—®é¢˜2ï¼šå¦‚ä½•è°ƒç”¨äº¤æ˜“æ‰€APIï¼Ÿ
   exchange.fetch_klines(
       start_time=????,  # ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹
       end_time=????     # ä¸çŸ¥é“åˆ°ä»€ä¹ˆæ—¶å€™ç»“æŸ
   )

âŒ é—®é¢˜3ï¼šäº¤æ˜“æ‰€æœ‰è¿™ä¹ˆå¤šå†å²æ•°æ®å—ï¼Ÿ
   - 2000æ ¹1d = 5.5å¹´å†å²
   - Binanceå¯èƒ½åªä¿ç•™1-2å¹´çš„1dæ•°æ®

âŒ é—®é¢˜4ï¼šè¿™äº›ä¹…è¿œçš„æ•°æ®æœ‰ç”¨å—ï¼Ÿ
   - å®æ—¶äº¤æ˜“ç³»ç»Ÿé€šå¸¸åªéœ€è¦æœ€è¿‘å‡ ä¸ªæœˆçš„æ•°æ®
```

---

### åœºæ™¯3ï¼šæŒ‰æ•°é‡ä¿®å¤æŒ‡æ ‡ï¼ˆæ­£å¸¸ï¼‰âœ…

```python
# é—®é¢˜ï¼šæŒ‡æ ‡è®¡ç®—é—æ¼ï¼Œåªæœ‰éƒ¨åˆ†æŒ‡æ ‡
æ•°æ®åº“Kçº¿ï¼š311æ ¹1d Kçº¿ï¼ˆå®Œæ•´ï¼‰
æ•°æ®åº“æŒ‡æ ‡ï¼š30ä¸ªæŒ‡æ ‡ï¼ˆéƒ¨åˆ†é—æ¼ï¼‰
æœŸæœ›ï¼šæ‰€æœ‰Kçº¿éƒ½æœ‰æŒ‡æ ‡

# æ£€æµ‹
klines_count = 2000
detect_indicator_gaps(klines_count=2000)
â†’ Kçº¿æœ‰311æ ¹ï¼ŒæŒ‡æ ‡æœ‰30ä¸ªï¼Œç¼ºå°‘281ä¸ª

# ä¿®å¤
klines = db.get_recent_klines(limit=2000)  # è·å–æœ€è¿‘2000æ ¹ï¼ˆå®é™…311æ ¹ï¼‰
for kline in klines:
    if not db.has_indicator(kline.timestamp):
        # åŸºäºKçº¿æœ¬åœ°è®¡ç®—æŒ‡æ ‡
        indicator = calculate_indicators(kline)
        db.save_indicator(indicator)

âœ… è¡¥å……281ä¸ªæŒ‡æ ‡ï¼Œæ‰€æœ‰Kçº¿éƒ½æœ‰æŒ‡æ ‡äº†
```

---

## ğŸ¯ é…ç½®å»ºè®®

### ç”Ÿäº§ç¯å¢ƒï¼ˆæŒ‰æ—¶é—´ï¼‰

```python
# config.py
repair_by_count = False  # æŒ‰æ—¶é—´æ¨¡å¼
repair_days_back = 30     # æ£€æŸ¥æœ€è¿‘30å¤©

# æ•ˆæœ
1d:  30 æ ¹æŒ‡æ ‡ï¼ˆ30å¤©ï¼‰
1h:  720 æ ¹æŒ‡æ ‡ï¼ˆ30å¤©ï¼‰
3m:  14400 æ ¹æŒ‡æ ‡ï¼ˆ30å¤©ï¼‰

# ä¼˜åŠ¿
âœ… ç¡®ä¿æ—¶é—´è¿ç»­æ€§
âœ… Kçº¿å’ŒæŒ‡æ ‡éƒ½èƒ½ä¿®å¤
âœ… ç¬¦åˆå®æ—¶äº¤æ˜“éœ€æ±‚
```

### ç­–ç•¥å¼€å‘/å›æµ‹ï¼ˆæŒ‰æ•°é‡ï¼‰

```python
# config.py
repair_by_count = True    # æŒ‰æ•°é‡æ¨¡å¼
repair_klines_count = 2000  # æ¯ä¸ªå‘¨æœŸ2000æ ¹

# æ•ˆæœ
1d:  2000 æ ¹æŒ‡æ ‡ï¼ˆ5.5å¹´ï¼‰
1h:  2000 æ ¹æŒ‡æ ‡ï¼ˆ83å¤©ï¼‰
3m:  2000 æ ¹æŒ‡æ ‡ï¼ˆ4å¤©ï¼‰

# ä¼˜åŠ¿
âœ… æ ·æœ¬é‡ç»Ÿä¸€
âœ… å›æµ‹å¯¹æ¯”å…¬å¹³
âœ… é€‚åˆç­–ç•¥å¼€å‘
âš ï¸  åªä¿®å¤æŒ‡æ ‡ï¼Œä¸ä¿®å¤Kçº¿
```

---

## ğŸ”§ ä»£ç å®ç°é€»è¾‘

### Kçº¿ä¿®å¤ï¼šå¿…é¡»æŒ‰æ—¶é—´

```python
async def detect_kline_gaps(days_back: float):
    """Kçº¿ç¼ºå¤±æ£€æµ‹ï¼ˆåªæ”¯æŒæŒ‰æ—¶é—´ï¼‰"""
    # è®¡ç®—æ—¶é—´èŒƒå›´
    end_time = int(datetime.now().timestamp())
    start_time = end_time - int(days_back * 86400)
    
    # ç”ŸæˆæœŸæœ›çš„æ—¶é—´æˆ³åºåˆ—
    expected_timestamps = generate_expected_timestamps(
        start_time, end_time, interval
    )
    
    # è·å–æ•°æ®åº“ä¸­çš„Kçº¿
    existing_klines = db.get_klines_in_range(start_time, end_time)
    existing_timestamps = {k.timestamp for k in existing_klines}
    
    # æ‰¾å‡ºç¼ºå¤±çš„æ—¶é—´æ®µ
    missing = expected_timestamps - existing_timestamps
    
    return missing

async def backfill_klines(missing_timestamps):
    """ä»äº¤æ˜“æ‰€è¡¥å……Kçº¿"""
    for timestamp in missing_timestamps:
        # è°ƒç”¨äº¤æ˜“æ‰€APIï¼ŒæŒ‡å®šæ˜ç¡®çš„æ—¶é—´
        klines = exchange.fetch_klines(
            start_time=timestamp,
            end_time=timestamp + interval
        )
        db.save_klines(klines)
```

### æŒ‡æ ‡ä¿®å¤ï¼šæ”¯æŒæŒ‰æ—¶é—´å’ŒæŒ‰æ•°é‡

```python
async def detect_indicator_gaps(
    days_back: float = None,
    klines_count: int = None
):
    """æŒ‡æ ‡ç¼ºå¤±æ£€æµ‹ï¼ˆæ”¯æŒä¸¤ç§æ¨¡å¼ï¼‰"""
    if klines_count:
        # æŒ‰æ•°é‡æ¨¡å¼ï¼šè·å–æœ€è¿‘Næ ¹Kçº¿
        klines = db.get_recent_klines(limit=klines_count)
        kline_timestamps = {k.timestamp for k in klines}
    else:
        # æŒ‰æ—¶é—´æ¨¡å¼ï¼šè·å–æ—¶é—´èŒƒå›´å†…çš„Kçº¿
        cutoff = now - days_back * 86400
        klines = db.get_klines_after(cutoff)
        kline_timestamps = {k.timestamp for k in klines}
    
    # è·å–å·²æœ‰çš„æŒ‡æ ‡
    indicators = db.get_indicators()
    indicator_timestamps = {i.timestamp for i in indicators}
    
    # æ‰¾å‡ºæœ‰Kçº¿ä½†æ²¡æŒ‡æ ‡çš„
    missing = kline_timestamps - indicator_timestamps
    
    return missing

async def backfill_indicators(missing_timestamps):
    """æœ¬åœ°è®¡ç®—æŒ‡æ ‡"""
    for timestamp in missing_timestamps:
        # è·å–è¯¥æ—¶é—´ç‚¹çš„Kçº¿
        kline = db.get_kline_at(timestamp)
        
        # æœ¬åœ°è®¡ç®—æŒ‡æ ‡ï¼ˆä¸éœ€è¦äº¤æ˜“æ‰€APIï¼‰
        indicator = calculate_indicators(kline)
        
        db.save_indicator(indicator)
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æŒ‰æ—¶é—´ä¿®å¤ 30å¤©

```
Kçº¿ä¿®å¤ï¼š
- æ£€æµ‹ï¼šæ‰«æ30å¤©æ—¶é—´èŒƒå›´
- ä¿®å¤ï¼šè°ƒç”¨äº¤æ˜“æ‰€APIï¼ˆå¦‚æœ‰ç¼ºå¤±ï¼‰
- æ—¶é—´ï¼šå–å†³äºç½‘ç»œå’Œäº¤æ˜“æ‰€å“åº”

æŒ‡æ ‡ä¿®å¤ï¼š
- 1d:  30 ä¸ªæŒ‡æ ‡ï¼ˆ< 1ç§’ï¼‰
- 1h:  720 ä¸ªæŒ‡æ ‡ï¼ˆ< 10ç§’ï¼‰
- 3m:  14400 ä¸ªæŒ‡æ ‡ï¼ˆ~3åˆ†é’Ÿï¼‰
```

### æŒ‰æ•°é‡ä¿®å¤ 2000æ ¹

```
Kçº¿ä¿®å¤ï¼š
- âŒ ä¸æ”¯æŒ

æŒ‡æ ‡ä¿®å¤ï¼š
- 1d:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- 1h:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- 3m:  2000 ä¸ªæŒ‡æ ‡ï¼ˆ~30ç§’ï¼‰
- âœ… æ‰€æœ‰å‘¨æœŸè€—æ—¶ç›¸åŒ
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æŒ‰æ•°é‡æ¨¡å¼çš„é™åˆ¶

```python
repair_by_count = True

é™åˆ¶ï¼š
âŒ ä¸æ”¯æŒKçº¿ä¿®å¤ï¼ˆè‡ªåŠ¨è·³è¿‡ï¼‰
âœ… åªæ”¯æŒæŒ‡æ ‡ä¿®å¤
âš ï¸  å¦‚æœæ•°æ®åº“Kçº¿ä¸è¶³2000æ ¹ï¼Œä¼šä¿®å¤æ‰€æœ‰å¯ç”¨çš„
```

### 2. æ•°æ®ä¸è¶³æ—¶çš„è¡Œä¸º

```python
# æŒ‰æ•°é‡æ¨¡å¼ï¼ŒæœŸæœ›2000æ ¹ï¼Œä½†åªæœ‰311æ ¹
klines_count = 2000
actual_klines = 311

è¡Œä¸ºï¼š
â†’ è·å–å…¨éƒ¨311æ ¹Kçº¿
â†’ æ£€æµ‹å’Œä¿®å¤è¿™311æ ¹çš„æŒ‡æ ‡
â†’ ä¸ä¼šæŠ¥é”™
â†’ æ—¥å¿—ä¼šæ˜¾ç¤ºå®é™…æ•°é‡ï¼š
   "K-lines in range: 311"
```

### 3. æ··åˆä½¿ç”¨å»ºè®®

```python
# ç”Ÿäº§ç¯å¢ƒï¼šæŒ‰æ—¶é—´ï¼ˆæ¯å¤©è‡ªåŠ¨è¿è¡Œï¼‰
if is_production:
    repair_by_count = False
    repair_days_back = 7  # æ£€æŸ¥æœ€è¿‘ä¸€å‘¨

# å¼€å‘ç¯å¢ƒï¼šæŒ‰æ•°é‡ï¼ˆæ‰‹åŠ¨è¿è¡Œï¼‰
if is_development:
    repair_by_count = True
    repair_klines_count = 2000  # ç»Ÿä¸€æ ·æœ¬é‡
```

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒåŸåˆ™

**Kçº¿ä¿®å¤ = å¤–éƒ¨æ•°æ®åŒæ­¥ â†’ å¿…é¡»æŒ‰æ—¶é—´**
- æ•°æ®æ¥è‡ªäº¤æ˜“æ‰€API
- APIè¦æ±‚æ—¶é—´èŒƒå›´
- æ—¶é—´ç¼ºå£æœ‰æ˜ç¡®è¯­ä¹‰

**æŒ‡æ ‡ä¿®å¤ = æœ¬åœ°æ•°æ®è®¡ç®— â†’ å¯æŒ‰æ—¶é—´æˆ–æ•°é‡**
- æ•°æ®æ¥è‡ªæœ¬åœ°Kçº¿
- æœ¬åœ°è®¡ç®—ï¼Œçµæ´»åº¦é«˜
- æŒ‰æ•°é‡æœ‰å®é™…æ„ä¹‰ï¼ˆå›æµ‹ã€å¯¹æ¯”ï¼‰

### é€‰æ‹©å»ºè®®

| åœºæ™¯ | æ¨èæ¨¡å¼ | åŸå›  |
|------|---------|------|
| ç”Ÿäº§ç¯å¢ƒ | æŒ‰æ—¶é—´ | ç¡®ä¿æ•°æ®æ—¶é—´è¿ç»­æ€§ |
| å®æ—¶äº¤æ˜“ | æŒ‰æ—¶é—´ | åªéœ€æœ€è¿‘çš„æ•°æ® |
| ç­–ç•¥å›æµ‹ | æŒ‰æ•°é‡ | æ ·æœ¬é‡ç»Ÿä¸€ï¼Œå¯¹æ¯”å…¬å¹³ |
| ç®—æ³•ç ”ç©¶ | æŒ‰æ•°é‡ | æ§åˆ¶å˜é‡ï¼Œç»Ÿè®¡ä¸€è‡´ |
| ç´§æ€¥ä¿®å¤ | æŒ‰æ—¶é—´ | Kçº¿+æŒ‡æ ‡éƒ½èƒ½ä¿®å¤ |

### æœ€ä½³å®è·µ

```python
# 1. é»˜è®¤é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
repair_by_count = False
repair_days_back = 30

# 2. å›æµ‹å‡†å¤‡ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
repair_by_count = True
repair_klines_count = 2000

# 3. ç´§æ€¥ä¿®å¤ï¼ˆæ‰‹åŠ¨åˆ‡æ¢ï¼‰
repair_by_count = False
repair_days_back = 7  # åªä¿®å¤æœ€è¿‘ä¸€å‘¨
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æŒ‡æ ‡å…ƒæ•°æ®é…ç½®](./indicator-metadata.md)
- [æŒ‡æ ‡æ”¹è¿›æŠ¥å‘Š](./indicator-improvement-report.md)
- [æ•°æ®å®Œæ•´æ€§æœåŠ¡](../backend/app/services/data_integrity.py)

---

**æœ€åæ›´æ–°ï¼š** 2025-11-09

